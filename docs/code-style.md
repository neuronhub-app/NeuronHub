# Code Style

## Core Principles

### You must write dumb, self-documented code

- Devs overestimate self intelligence - KISS
- Extract explanatory variables and functions

Comments
- Comments are a terrible code smell, and are only for unusual cases (tell why, not what)
- Every comment is a tech debt, it'll fuck up devs once outdated

### You must manage complexity

You're working on a pre-MVP pre-PMF codebase:
- Extreme complexity engineering is a must for survival
- We must avoid the hell of "*cheaper to rewrite from 0 than comprehend*"
- You must minimize surface area - every line of code is tech debt

#### Defensive code is tech debt

- Always prefer clean code instead handling potential library issues
- Fail fast - use `assert` or `!` instead of complex error handling
- Assume backend enforces invariants. Use `?.` chaining, not defensive `if`s
- Don't conceal errors instead of sending to Sentry. 

#### Best practices

- Define variables as close as possible to the point of use
- Functions > 20 lines → decompose. Think of later debugging prod at 3am.
- When objects are used only in one place - keep them together, esp if file is below 200 LOC
- Single-use vars → inline as named args
- In functions accept objects over primitives: `update(user: User)` not `update(id: string)`
- Avoid "smart" constructs as `reduce` or list comprehensions 
- Create wrappers to declutter bad syntax from third-party

## React

### Components

Hypothetical example of a typical inner hierarchy and imports:
```tsx
import { useApolloQuery } from "@/graphql/useApolloQuery";
import { client } from "@/graphql/client"; // configured Apollo Client
import { useUser } from "@/apps/users/useUserCurrent";
import { ID, graphql } from "@/gql-tada";
import { useInit } from "@/utils/useInit";

export function Card(props: { id: ID; className?: string }) {
  // 1. Defaults
  const className = props.className ?? "default";
  
  // 2. Hooks

  const user = useUser();

  const { data, error, isLoadingFirstTime } = useApolloQuery(
    graphql(`query Post($id: ID!) { post(id: $id) { ... } }`),
    { id: props.id },
  );

  // 3. State

  const state = useValtioProxyRef({ isDialogOpen: false });

  // 3. Functions and handlers

  useInit({
    isBlocked: isLoadingFirstTime,
    init: () => { ... },
    deps: [],
  });

  async function handleClick() {
    await client.mutate({ ... });
  }

  // 4. Variables JSX render
  const name = user.name ?? "Anonymous";

  return (
    <DialogRoot
      open={state.snap.isDialogOpen}
      onOpenChange={event => state.mutable.isDialogOpen = event.open }
    >
    </DialogRoot>
  );
}
```

### Chakra v3

In `src/components/ui` is bad code generated by Chakra CLI. Chakra dropped the idea, so we're replacing it with import from `@chakra-ui/react`.
